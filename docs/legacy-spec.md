# 経費申請システム仕様書（従来手法版）

## 概要

この仕様書は、**従来の開発手法における典型的な問題**を意図的に含む経費申請システムの仕様書です。形式手法との対比を明確にするため、以下のような**曖昧さと不完全性**を意図的に組み込んでいます。

---

## 🔴 意図的な問題点の解説

### 1. 状態遷移の曖昧性
**問題**: 状態名の不統一、遷移条件の不明確さ
- 「申請中」「承認待ち」「処理中」などの類似状態の区別が不明
- 「適切な権限者」という曖昧な表現
- 遷移の前提条件が自然言語で記述され、解釈に依存

**形式手法での解決**: TLA+による厳密な状態定義と遷移条件の論理式化

### 2. 金額境界の不整合
**問題**: 境界値の曖昧性、データ型の未定義
- 「10,000円以下」と「10,001円以上」の間に隙間
- 金額のデータ型（整数？小数？）が未定義
- 通貨単位の混在可能性

**形式手法での解決**: Alloyによる制約の形式化と境界値の厳密定義

### 3. 権限モデルの不完全性
**問題**: 組織階層、代理承認の未定義
- 「上司」の定義が曖昧（直属？部長？）
- 休暇時の代理承認ルールが未定義
- 組織変更時の権限継承が不明

**形式手法での解決**: 関係モデルによる権限の数学的定義

### 4. 時間制約の曖昧性
**問題**: 主観的表現、期限起点の不明確さ
- 「速やかに」「適時に」などの主観的表現
- 営業日/カレンダー日の区別が不明
- タイムゾーンの考慮なし

**形式手法での解決**: 時相論理による時間制約の厳密化

### 5. エラー処理の抽象性
**問題**: 具体的対応方法の欠如
- 「エラーが発生した場合は適切に処理する」
- システムダウン時の対応が未定義
- データ不整合時の復旧手順なし

**形式手法での解決**: 例外状態の完全列挙と処理ロジックの仕様化

### 6. 同期処理の問題
**問題**: 並行アクセス時の動作未定義
- 同時承認時の競合状態が未考慮
- ロック機構の仕様なし
- データ整合性の保証なし

**形式手法での解決**: 並行性モデルによる同期メカニズムの定義

### 7. ビジネスルールの例外処理
**問題**: 特別ケースの未考慮
- 緊急時の特別承認フローなし
- 金額変更時の再承認ルールが曖昧
- 年度末処理などの特殊条件が未定義

**形式手法での解決**: 全ての例外ケースの網羅的な仕様化

### 8. データ整合性の不備
**問題**: 整合性チェックの曖昧さ
- 関連データの整合性ルールが散文
- バリデーションロジックの不完全性
- データ移行時の整合性保証なし

**形式手法での解決**: 不変条件と制約の数学的表現

---

## システム概要（意図的に曖昧な記述）

経費申請システムは、社員が経費を申請し、適切な権限者が承認するシステムです。

### 主要機能
- 経費申請の登録
- 承認フローの管理
- レポート出力
- 通知機能

## 申請フロー（曖昧な状態遷移）

1. **申請作成**: 社員が経費情報を入力
2. **申請中**: システムが申請を受け付け
3. **承認待ち**: 上司による確認待ち
4. **承認済み**: 承認が完了
5. **却下**: 申請が拒否された場合
6. **処理完了**: 経理処理が終了

## 承認ルール（不明確な境界値）

- **少額**: 10,000円以下は直属上司のみ
- **中額**: 10,000円～50,000円は部長承認が必要
- **高額**: 50,000円以上は役員承認が必要

## システム要件（抽象的な記述）

### 機能要件
- 使いやすいインターフェース
- 高速な処理
- 正確なデータ管理
- 適切なセキュリティ

### 非機能要件
- 十分なパフォーマンス
- 高い可用性
- スケーラブルな設計
- 堅牢なエラー処理

## データ項目（不完全な定義）

### 経費申請
- 申請ID（何らかの一意な値）
- 申請者（社員情報）
- 金額（数値）
- 種別（出張費、交通費など）
- 申請日（日付）
- 状態（申請中、承認済みなど）

## 制約事項（曖昧なルール）

- 自己承認は禁止
- 承認は順次実行
- 期限内に処理すること
- データの整合性を保つこと

---

## 🎯 対比：従来手法 vs 形式手法

| 項目 | 従来手法 | 形式手法 |
|------|----------|----------|
| **明確性** | 自然言語の曖昧さ | 数学的に厳密 |
| **検証可能性** | 手動テストのみ | 自動モデル検査 |
| **実装ガイド** | 解釈に依存 | 機械的変換可能 |
| **制約表現** | 散文での説明 | 論理式による定義 |
| **状態管理** | 不明確な状態 | 厳密な状態機械 |
| **エラー処理** | 抽象的記述 | 全例外ケース網羅 |
| **AI開発適合性** | 曖昧で生成困難 | 明確でAI生成に最適 |

---

## 💡 AI駆動開発における形式手法の価値

このような従来仕様書では、AI（Cursor、Cline、Devinなど）が以下の問題に直面します：

1. **文脈依存の解釈**: 曖昧な表現をAIが独自に解釈し、意図しない実装
2. **不完全な実装**: 未定義の例外ケースでAIが適当な実装を生成
3. **整合性の欠如**: 散在したルールの矛盾をAIが検出できない
4. **テスト生成の困難**: 曖昧な仕様からは適切なテストケースを生成不可

**形式手法により**、これらの問題が解決され、AIが高品質なコードを生成できるフレームワークが提供されます。

---

## 結論

この仕様書は**意図的に問題のある従来手法**の例です。Phase 2以降では、同じ要件を形式手法（TLA+、Alloy）で厳密に定義し、関数型プログラミング（Kotlin + Arrow、React + fp-ts）で実装することで、**AI駆動開発における形式手法の有効性**を実証します。