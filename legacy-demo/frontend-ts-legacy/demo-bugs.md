# Legacy Frontend Implementation - Intentional Problems

この実装は従来の開発手法による問題のあるパターンを実演するためのものです。以下の問題が意図的に含まれています：

## 型安全性の問題

### 1. `any` 型の乱用
- **ファイル**: `expense-form.ts`, `approval-logic.ts`, `state-management.ts`
- **問題**: 型安全性を失い、ランタイムエラーの原因
- **例**: `private expense: any;` (expense-form.ts:4)

### 2. オプショナル型の不適切な使用
- **ファイル**: `approval-logic.ts`
- **問題**: null/undefined チェックが不十分
- **例**: `manager?: number` が null参照エラーの原因

### 3. 文字列型でのEnum表現
- **ファイル**: 全ファイル
- **問題**: タイポによるバグ、無効な値の許可
- **例**: `role: string` の代わりに Union types を使うべき

## 状態管理の問題

### 1. グローバルミューテブル状態
- **ファイル**: `state-management.ts`
- **問題**: 予期しない状態変更、デバッグが困難
- **例**: `let globalState: any` (state-management.ts:3)

### 2. 直接的な状態変更
- **ファイル**: 全ファイル
- **問題**: 状態の一貫性が保証されない
- **例**: `this.expense.status = "submitted"` (expense-form.ts:32)

### 3. 副作用のあるGetter
- **ファイル**: `expense-form.ts`, `state-management.ts`
- **問題**: 読み取り操作で状態が変わる
- **例**: `getStatus()` メソッドで状態を変更 (expense-form.ts:73)

## ビジネスロジックの問題

### 1. バリデーション不足
- **ファイル**: `expense-form.ts`
- **問題**: 無効なデータでの申請を許可
- **例**: 負の金額、空の申請者名

### 2. 自己承認の不完全な防止
- **ファイル**: `approval-logic.ts`
- **問題**: 場合によっては自己承認が可能
- **例**: `canApprove` メソッドの条件が不十分

### 3. 承認フローの不整合
- **ファイル**: `approval-logic.ts`
- **問題**: 順序が守られない場合がある
- **例**: Director が Manager 承認前に承認可能

## エラーハンドリングの問題

### 1. サイレントエラー
- **ファイル**: 全ファイル
- **問題**: エラーが隠蔽され、問題の特定が困難
- **例**: `console.log("Error occurred")` (expense-form.ts:48)

### 2. 汎用的なエラーメッセージ
- **ファイル**: 全ファイル
- **問題**: ユーザーに有用な情報を提供しない
- **例**: "Failed to submit expense"

### 3. 例外の不適切な処理
- **ファイル**: `state-management.ts`
- **問題**: キャッチしても適切に処理しない
- **例**: リスナーエラーの無視

## パフォーマンスの問題

### 1. 非効率な検索
- **ファイル**: `approval-logic.ts`, `state-management.ts`
- **問題**: 配列の線形検索を多用
- **例**: `users.find()` の繰り返し実行

### 2. 不要な再計算
- **ファイル**: `state-management.ts`
- **問題**: キャッシュ機構の不備
- **例**: `getExpenseStats()` の度に計算

### 3. 同期処理のブロッキング
- **ファイル**: 全ファイル
- **問題**: UIがブロックされる可能性
- **例**: 同期的な初期化処理

## アーキテクチャの問題

### 1. 責務の混在
- **ファイル**: 全ファイル
- **問題**: ビジネスロジック、UI、データアクセスが混在
- **例**: DOM操作とビジネスロジックが同一関数

### 2. 密結合
- **ファイル**: 全ファイル
- **問題**: モジュール間の依存関係が複雑
- **例**: グローバル状態への直接アクセス

### 3. テストの困難性
- **ファイル**: 全ファイル
- **問題**: 副作用が多く、単体テストが困難
- **例**: コンストラクタでの副作用

## セキュリティの問題

### 1. 入力値検証の不足
- **ファイル**: 全ファイル
- **問題**: インジェクション攻撃のリスク
- **例**: 未検証のユーザー入力をそのまま使用

### 2. 認証チェックの不備
- **ファイル**: `approval-logic.ts`
- **問題**: 権限チェックが不十分
- **例**: `reject` メソッドに認証チェックなし

## メモリリークの問題

### 1. イベントリスナーの未解放
- **ファイル**: `expense-form.ts`
- **問題**: ページ遷移時にリスナーが残る
- **例**: DOM イベントリスナーの登録のみ

### 2. 循環参照
- **ファイル**: `state-management.ts`
- **問題**: ガベージコレクションが妨げられる
- **例**: リスナー配列の不適切な管理

---

## 改善すべき点のまとめ

1. **型安全性**: Union types, strict null checks
2. **不変性**: Immutable data structures
3. **副作用の分離**: Pure functions, functional approach
4. **適切なエラーハンドリング**: Result/Either types
5. **パフォーマンス**: 効率的なデータ構造とアルゴリズム
6. **アーキテクチャ**: 層分離、単一責任原則
7. **テスタビリティ**: 依存性注入、純粋関数

これらの問題点は Phase 2, 3 で関数型プログラミングと形式手法により解決されます。